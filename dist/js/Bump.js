"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),Bump=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:PIXI;if(_classCallCheck(this,t),void 0===e)throw new Error("Please assign a rendering engine in the constructor before using bump.js");this.renderer="pixi"}return _createClass(t,[{key:"addCollisionProperties",value:function(t){"pixi"===this.renderer&&(void 0===t.gx&&Object.defineProperty(t,"gx",{get:function(){return t.getGlobalPosition().x},enumerable:!0,configurable:!0}),void 0===t.gy&&Object.defineProperty(t,"gy",{get:function(){return t.getGlobalPosition().y},enumerable:!0,configurable:!0}),void 0===t.centerX&&Object.defineProperty(t,"centerX",{get:function(){return t.x+t.width/2},enumerable:!0,configurable:!0}),void 0===t.centerY&&Object.defineProperty(t,"centerY",{get:function(){return t.y+t.height/2},enumerable:!0,configurable:!0}),void 0===t.halfWidth&&Object.defineProperty(t,"halfWidth",{get:function(){return t.width/2},enumerable:!0,configurable:!0}),void 0===t.halfHeight&&Object.defineProperty(t,"halfHeight",{get:function(){return t.height/2},enumerable:!0,configurable:!0}),void 0===t.xAnchorOffset&&Object.defineProperty(t,"xAnchorOffset",{get:function(){return void 0!==t.anchor?t.width*t.anchor.x:0},enumerable:!0,configurable:!0}),void 0===t.yAnchorOffset&&Object.defineProperty(t,"yAnchorOffset",{get:function(){return void 0!==t.anchor?t.height*t.anchor.y:0},enumerable:!0,configurable:!0}),t.circular&&void 0===t.radius&&Object.defineProperty(t,"radius",{get:function(){return t.width/2},enumerable:!0,configurable:!0})),t._bumpPropertiesAdded=!0}},{key:"hitTestPoint",value:function(t,e){e._bumpPropertiesAdded||this.addCollisionProperties(e);var i=void 0,r=void 0,o=void 0,n=void 0,h=void 0,s=void 0;if(i=e.radius?"circle":"rectangle","rectangle"===i&&(r=e.x-e.xAnchorOffset,o=e.x+e.width-e.xAnchorOffset,n=e.y-e.yAnchorOffset,h=e.y+e.height-e.yAnchorOffset,s=t.x>r&&t.x<o&&t.y>n&&t.y<h),"circle"===i){var d=t.x-e.x-e.width/2+e.xAnchorOffset,a=t.y-e.y-e.height/2+e.yAnchorOffset;s=Math.sqrt(d*d+a*a)<e.radius}return s}},{key:"hitTestCircle",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var r=void 0,o=void 0,n=void 0,h=void 0;return i?(r=e.gx+e.width/2-e.xAnchorOffset-(t.gx+t.width/2-t.xAnchorOffset),o=e.gy+e.width/2-e.yAnchorOffset-(t.gy+t.width/2-t.yAnchorOffset)):(r=e.x+e.width/2-e.xAnchorOffset-(t.x+t.width/2-t.xAnchorOffset),o=e.y+e.width/2-e.yAnchorOffset-(t.y+t.width/2-t.yAnchorOffset)),n=Math.sqrt(r*r+o*o),h=t.radius+e.radius,n<h}},{key:"circleCollision",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var o=void 0,n=void 0,h=void 0,s=void 0,d=void 0,a=void 0,f=void 0,c={},l=!1;if(r?(s=e.gx+e.width/2-e.xAnchorOffset-(t.gx+t.width/2-t.xAnchorOffset),d=e.gy+e.width/2-e.yAnchorOffset-(t.gy+t.width/2-t.yAnchorOffset)):(s=e.x+e.width/2-e.xAnchorOffset-(t.x+t.width/2-t.xAnchorOffset),d=e.y+e.width/2-e.yAnchorOffset-(t.y+t.width/2-t.yAnchorOffset)),o=Math.sqrt(s*s+d*d),n=t.radius+e.radius,o<n){l=!0,h=n-o;h+=.3,a=s/o,f=d/o,t.x-=h*a,t.y-=h*f,i&&(c.x=d,c.y=-s,this.bounceOffSurface(t,c))}return l}},{key:"movingCircleCollision",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var r=void 0,o=void 0,n=void 0,h=void 0,s={},d={},a={},f={},c={},l=!1;if(t.mass=t.mass||1,e.mass=e.mass||1,i?(s.vx=e.gx+e.radius-e.xAnchorOffset-(t.gx+t.radius-t.xAnchorOffset),s.vy=e.gy+e.radius-e.yAnchorOffset-(t.gy+t.radius-t.yAnchorOffset)):(s.vx=e.x+e.radius-e.xAnchorOffset-(t.x+t.radius-t.xAnchorOffset),s.vy=e.y+e.radius-e.yAnchorOffset-(t.y+t.radius-t.yAnchorOffset)),s.magnitude=Math.sqrt(s.vx*s.vx+s.vy*s.vy),r=t.radius+e.radius,s.magnitude<r){l=!0,o=r-s.magnitude,o+=.3,s.dx=s.vx/s.magnitude,s.dy=s.vy/s.magnitude,s.vxHalf=Math.abs(s.dx*o/2),s.vyHalf=Math.abs(s.dy*o/2),n=t.x>e.x?1:-1,h=t.y>e.y?1:-1,t.x=t.x+s.vxHalf*n,t.y=t.y+s.vyHalf*h,e.x=e.x+s.vxHalf*-n,e.y=e.y+s.vyHalf*-h,s.lx=s.vy,s.ly=-s.vx;var y=t.vx*s.dx+t.vy*s.dy;d.x=y*s.dx,d.y=y*s.dy;var v=t.vx*(s.lx/s.magnitude)+t.vy*(s.ly/s.magnitude);a.x=v*(s.lx/s.magnitude),a.y=v*(s.ly/s.magnitude);var x=e.vx*s.dx+e.vy*s.dy;f.x=x*s.dx,f.y=x*s.dy;var u=e.vx*(s.lx/s.magnitude)+e.vy*(s.ly/s.magnitude);c.x=u*(s.lx/s.magnitude),c.y=u*(s.ly/s.magnitude),t.bounce={},t.bounce.x=a.x+f.x,t.bounce.y=a.y+f.y,e.bounce={},e.bounce.x=d.x+c.x,e.bounce.y=d.y+c.y,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass}return l}},{key:"multipleCircleCollision",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;i<t.length;i++)for(var r=t[i],o=i+1;o<t.length;o++){var n=t[o];this.movingCircleCollision(r,n,e)}}},{key:"rectangleCollision",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var o=void 0,n=void 0,h=void 0,s=void 0,d=void 0,a=void 0,f=void 0;return r?(a=t.gx+Math.abs(t.halfWidth)-t.xAnchorOffset-(e.gx+Math.abs(e.halfWidth)-e.xAnchorOffset),f=t.gy+Math.abs(t.halfHeight)-t.yAnchorOffset-(e.gy+Math.abs(e.halfHeight)-e.yAnchorOffset)):(a=t.x+Math.abs(t.halfWidth)-t.xAnchorOffset-(e.x+Math.abs(e.halfWidth)-e.xAnchorOffset),f=t.y+Math.abs(t.halfHeight)-t.yAnchorOffset-(e.y+Math.abs(e.halfHeight)-e.yAnchorOffset)),n=Math.abs(t.halfWidth)+Math.abs(e.halfWidth),h=Math.abs(t.halfHeight)+Math.abs(e.halfHeight),Math.abs(a)<n&&Math.abs(f)<h&&(s=n-Math.abs(a),d=h-Math.abs(f),s>=d?(f>0?(o="top",t.y=t.y+d):(o="bottom",t.y=t.y-d),i&&(t.vy*=-1)):(a>0?(o="left",t.x=t.x+s):(o="right",t.x=t.x-s),i&&(t.vx*=-1))),o}},{key:"hitTestRectangle",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var r=void 0,o=void 0,n=void 0,h=void 0;return!1,i?(n=t.gx+Math.abs(t.halfWidth)-t.xAnchorOffset-(e.gx+Math.abs(e.halfWidth)-e.xAnchorOffset),h=t.gy+Math.abs(t.halfHeight)-t.yAnchorOffset-(e.gy+Math.abs(e.halfHeight)-e.yAnchorOffset)):(n=t.x+Math.abs(t.halfWidth)-t.xAnchorOffset-(e.x+Math.abs(e.halfWidth)-e.xAnchorOffset),h=t.y+Math.abs(t.halfHeight)-t.yAnchorOffset-(e.y+Math.abs(e.halfHeight)-e.yAnchorOffset)),r=Math.abs(t.halfWidth)+Math.abs(e.halfWidth),o=Math.abs(t.halfHeight)+Math.abs(e.halfHeight),Math.abs(n)<r&&Math.abs(h)<o}},{key:"hitTestCircleRectangle",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var r=void 0,o=void 0,n=void 0,h=void 0,s=void 0,d=void 0;if(i?(n=t.gx,h=t.gy,s=e.gx,d=e.gy):(n=t.x,h=t.y,s=e.x,d=e.y),"topMiddle"===(r=h-t.yAnchorOffset<d-Math.abs(e.halfHeight)-e.yAnchorOffset?n-t.xAnchorOffset<s-1-Math.abs(e.halfWidth)-e.xAnchorOffset?"topLeft":n-t.xAnchorOffset>s+1+Math.abs(e.halfWidth)-e.xAnchorOffset?"topRight":"topMiddle":h-t.yAnchorOffset>d+Math.abs(e.halfHeight)-e.yAnchorOffset?n-t.xAnchorOffset<s-1-Math.abs(e.halfWidth)-e.xAnchorOffset?"bottomLeft":n-t.xAnchorOffset>s+1+Math.abs(e.halfWidth)-e.xAnchorOffset?"bottomRight":"bottomMiddle":n-t.xAnchorOffset<s-Math.abs(e.halfWidth)-e.xAnchorOffset?"leftMiddle":"rightMiddle")||"bottomMiddle"===r||"leftMiddle"===r||"rightMiddle"===r)o=this.hitTestRectangle(t,e,i);else{var a={};switch(r){case"topLeft":a.x=s-e.xAnchorOffset,a.y=d-e.yAnchorOffset;break;case"topRight":a.x=s+e.width-e.xAnchorOffset,a.y=d-e.yAnchorOffset;break;case"bottomLeft":a.x=s-e.xAnchorOffset,a.y=d+e.height-e.yAnchorOffset;break;case"bottomRight":a.x=s+e.width-e.xAnchorOffset,a.y=d+e.height-e.yAnchorOffset}o=this.hitTestCirclePoint(t,a,i)}return o?r:o}},{key:"hitTestCirclePoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t._bumpPropertiesAdded||this.addCollisionProperties(t),e.diameter=1,e.width=e.diameter,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,e.xAnchorOffset=0,e.yAnchorOffset=0,e._bumpPropertiesAdded=!0,this.hitTestCircle(t,e,i)}},{key:"circleRectangleCollision",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var o=void 0,n=void 0,h=void 0,s=void 0,d=void 0,a=void 0;if(r?(h=t.gx,s=t.gy,d=e.gx,a=e.gy):(h=t.x,s=t.y,d=e.x,a=e.y),"topMiddle"===(o=s-t.yAnchorOffset<a-Math.abs(e.halfHeight)-e.yAnchorOffset?h-t.xAnchorOffset<d-1-Math.abs(e.halfWidth)-e.xAnchorOffset?"topLeft":h-t.xAnchorOffset>d+1+Math.abs(e.halfWidth)-e.xAnchorOffset?"topRight":"topMiddle":s-t.yAnchorOffset>a+Math.abs(e.halfHeight)-e.yAnchorOffset?h-t.xAnchorOffset<d-1-Math.abs(e.halfWidth)-e.xAnchorOffset?"bottomLeft":h-t.xAnchorOffset>d+1+Math.abs(e.halfWidth)-e.xAnchorOffset?"bottomRight":"bottomMiddle":h-t.xAnchorOffset<d-Math.abs(e.halfWidth)-e.xAnchorOffset?"leftMiddle":"rightMiddle")||"bottomMiddle"===o||"leftMiddle"===o||"rightMiddle"===o)n=this.rectangleCollision(t,e,i,r);else{var f={};switch(o){case"topLeft":f.x=d-e.xAnchorOffset,f.y=a-e.yAnchorOffset;break;case"topRight":f.x=d+e.width-e.xAnchorOffset,f.y=a-e.yAnchorOffset;break;case"bottomLeft":f.x=d-e.xAnchorOffset,f.y=a+e.height-e.yAnchorOffset;break;case"bottomRight":f.x=d+e.width-e.xAnchorOffset,f.y=a+e.height-e.yAnchorOffset}n=this.circlePointCollision(t,f,i,r)}return n?o:n}},{key:"circlePointCollision",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t._bumpPropertiesAdded||this.addCollisionProperties(t),e.diameter=1,e.width=e.diameter,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,e.xAnchorOffset=0,e.yAnchorOffset=0,e._bumpPropertiesAdded=!0,this.circleCollision(t,e,i,r)}},{key:"bounceOffSurface",value:function(t,e){t._bumpPropertiesAdded||this.addCollisionProperties(t);var i=void 0,r=void 0,o={},n={},h={},s=t.mass||1;e.lx=e.y,e.ly=-e.x,e.magnitude=Math.sqrt(e.x*e.x+e.y*e.y),e.dx=e.x/e.magnitude,e.dy=e.y/e.magnitude,i=t.vx*e.dx+t.vy*e.dy,o.vx=i*e.dx,o.vy=i*e.dy,r=t.vx*(e.lx/e.magnitude)+t.vy*(e.ly/e.magnitude),n.vx=r*(e.lx/e.magnitude),n.vy=r*(e.ly/e.magnitude),n.vx*=-1,n.vy*=-1,h.x=o.vx+n.vx,h.y=o.vy+n.vy,t.vx=h.x/s,t.vy=h.y/s}},{key:"contain",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;t._bumpPropertiesAdded||this.addCollisionProperties(t),void 0===e.xAnchorOffset&&(e.xAnchorOffset=0),void 0===e.yAnchorOffset&&(e.yAnchorOffset=0),void 0===t.parent.gx&&(t.parent.gx=0),void 0===t.parent.gy&&(t.parent.gy=0);var o=new Set;return t.x-t.xAnchorOffset<e.x-t.parent.gx-e.xAnchorOffset&&(i&&(t.vx*=-1),t.mass&&(t.vx/=t.mass),t.x=e.x-t.parent.gx-e.xAnchorOffset+t.xAnchorOffset,o.add("left")),t.y-t.yAnchorOffset<e.y-t.parent.gy-e.yAnchorOffset&&(i&&(t.vy*=-1),t.mass&&(t.vy/=t.mass),t.y=e.y-t.parent.gy-e.yAnchorOffset+t.yAnchorOffset,o.add("top")),t.x-t.xAnchorOffset+t.width>e.width-e.xAnchorOffset&&(i&&(t.vx*=-1),t.mass&&(t.vx/=t.mass),t.x=e.width-t.width-e.xAnchorOffset+t.xAnchorOffset,o.add("right")),t.y-t.yAnchorOffset+t.height>e.height-e.yAnchorOffset&&(i&&(t.vy*=-1),t.mass&&(t.vy/=t.mass),t.y=e.height-t.height-e.yAnchorOffset+t.yAnchorOffset,o.add("bottom")),0===o.size&&(o=void 0),o&&r&&r(o),o}},{key:"outsideBounds",value:function(t,e,i){var r=e.x,o=e.y,n=e.width,h=e.height,s=new Set;return t.x<r-t.width&&s.add("left"),t.y<o-t.height&&s.add("top"),t.x>n+t.width&&s.add("right"),t.y>h+t.height&&s.add("bottom"),0===s.size&&(s=void 0),s&&i&&i(s),s}},{key:"_getCenter",value:function(t,e,i){return void 0!==t.anchor?0!==t.anchor[i]?0:e/2:e}},{key:"hit",value:function(t,e){function i(t,e){var i=void 0!==t.parent,h=void 0!==e.parent;if(i&&h)return t.diameter&&e.diameter?r(t,e):t.diameter&&!e.diameter?n(t,e):o(t,e);if(h&&void 0!==t.x&&void 0!==t.y)return f(t,e);throw new Error("I'm sorry, "+t+" and "+e+" cannot be use together in a collision test.'")}function r(t,e){return h?t.vx+t.vy!==0&&e.vx+e.vy!==0?y(t,e,d):v(t,e,s,d):l(t,e)}function o(t,e){return h?u(t,e,s,d):c(t,e,d)}function n(t,e){return h?g(t,e,s,d):x(t,e,d)}var h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,f=this.hitTestPoint.bind(this),c=this.hitTestRectangle.bind(this),l=this.hitTestCircle.bind(this),y=this.movingCircleCollision.bind(this),v=this.circleCollision.bind(this),x=this.hitTestCircleRectangle.bind(this),u=this.rectangleCollision.bind(this),g=this.circleRectangleCollision.bind(this),b=void 0,A=void 0!==t.parent,O=void 0!==e.parent;return A&&e instanceof Array||O&&t instanceof Array?function(){Array;for(var r=e.length-1;r>=0;r--){var o=e[r];(b=i(t,o))&&a&&a(b,o)}}():(b=i(t,e))&&a&&a(b),b}}]),t}();