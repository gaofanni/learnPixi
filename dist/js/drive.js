"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),App=function(){function t(){var e=this;_classCallCheck(this,t),this.Container=PIXI.Container,this.autoDetectRenderer=PIXI.autoDetectRenderer,this.loader=PIXI.loader,this.resources=PIXI.loader.resources,this.Sprite=PIXI.Sprite,this.Graphics=PIXI.Graphics,this.BaseTexture=PIXI.BaseTexture,this.Texture=PIXI.Texture,this.Text=PIXI.Text,this.radio=window.innerWidth/640*2,this.bump=new Bump(PIXI),this.su=new SpriteUtilities(PIXI),this.d=new Dust(PIXI),this.wrapSize={x:540,y:808},this.renderer=PIXI.autoDetectRenderer(this.wrapSize.x*this.radio,this.wrapSize.y*this.radio,{antialias:!1,transparent:!0,resolution:1}),this.stage=new PIXI.Container,this.group=new this.Container,this.graphics=new this.Graphics,this.state=null,this.roadStage=null,this.hitTestElement=null,this.roadData={angle:Math.PI/180*-45,len:this.wrapSize.x*this.radio,gap:0,position:{x:0,y:0},roadWidth:200*this.radio},this.size=function(t){return t*e.radio},this.init()}return _createClass(t,[{key:"init",value:function(){this.mount(),this.load()}},{key:"mount",value:function(){document.querySelector("#app").appendChild(this.renderer.view),this.renderer.view.style.display="block",this.renderer.view.style.width=window.innerWidth+"px",this.renderer.view.style.margin="40px auto",this.renderer.view.style.transform="rotateX(35deg) translateZ(300px)",this.renderer.view.style.transformOrigin="center"}},{key:"play",value:function(){this.bump,this.hitTestElement;this.roadStage.y+=8,this.roadStage.children[0].getGlobalPosition().y>this.size(1600)&&(this.roadStage.removeChild(this.roadStage.children[0]),this.addRoad())}},{key:"load",value:function(){this.loader.add("./images/assets/test.json").load(this.setup.bind(this))}},{key:"setup",value:function(){var t=this,e=(this.Sprite,this.stage);this.resources,this.Graphics,this.size,this.wrapSize;this.roadStage=this.drawRoad();for(var i=15;i;)this.addRoad(),i--;e.addChild(this.roadStage),this.setHitTestElement(),this.state=this.play;!function e(){requestAnimationFrame(e),t.state(),t.renderer.render(t.stage)}()}},{key:"setHitTestElement",value:function(){var t=this.hitTestElement,e=this.Graphics,i=this.stage,s=this.size,a=this.wrapSize;t=(new e).beginFill("0x000000").drawRect(0,0,s(100),s(100)).endFill(),t.position.set(s(a.x/2),2*s(a.y)),i.addChild(t)}},{key:"drawRoad",value:function(){var t=(this.Sprite,this.stage,this.resources,this.Graphics,this.size),e=this.wrapSize,i=this.Container,s=new i;return s.width=t(e.x),s.height=t(e.y/2),s.pivot.set(t(e.x/2),0),s.rotation=Math.PI,s.position.set(t(e.x/2),t(e.y)),s}},{key:"addRoad",value:function(){var t=this.Graphics,e=this.roadStage,i=this.size,s=this.roadData,a=s.angle,r=s.len,n=s.position,h=s.roadWidth,o=(s.gap,new t);o.beginFill("0x0f5ff0").drawRect(i(-100),-h/2,h,r).endFill(),o.rotation=a,o.position.set(n.x,n.y),e.addChild(o),this.roadData.position=this.getPositionFromAngle(n,a,r),this.roadData.angle*=-1,this.roadData.len=Math.random()*(i(this.wrapSize.x)-i(.4*this.wrapSize.x))+i(.4*this.wrapSize.x)}},{key:"getPositionFromAngle",value:function(t,e,i){var s={x:t.x,y:t.y+i};return{x:(s.x-t.x)*Math.cos(e)-(s.y-t.y)*Math.sin(e)+t.x,y:(s.x-t.x)*Math.sin(e)+(s.y-t.y)*Math.cos(e)+t.y}}}]),t}();window.onload=function(){new App};